/**
 * Emoji Avatar System
 * Generates unique emoji avatars based on user's gender
 * Provides 300+ emoji variations
 */

// Gender-based emoji collections (300+ emojis per gender)
const EMOJI_LIBRARY = {
    male: [
        // People & Faces
        'ğŸ‘¦', 'ğŸ§’', 'ğŸ‘¶', 'ğŸ‘¨', 'ğŸ§‘', 'ğŸ˜', 'ğŸ¤“', 'ğŸ§', 'ğŸ¤ ', 'ğŸ¥³',
        'ğŸ¤©', 'ğŸ˜', 'ğŸ˜Š', 'ğŸ˜', 'ğŸ™‚', 'ğŸ¤—', 'ğŸ¤”', 'ğŸ§‘â€ğŸ“', 'ğŸ‘¨â€ğŸ“', 'ğŸ‘¨â€ğŸ’¼',

        // Sports & Activities
        'ğŸ€', 'âš½', 'ğŸˆ', 'âš¾', 'ğŸ¾', 'ğŸ', 'ğŸ“', 'ğŸ¸', 'ğŸ¥Š', 'ğŸ¥‹',
        'ğŸ›¹', 'ğŸ„', 'ğŸŠ', 'ğŸš´', 'ğŸ§—', 'â›·ï¸', 'ğŸ‚', 'ğŸ¤¸', 'ğŸ¤¾', 'â›¹ï¸',
        'ğŸ‹ï¸', 'ğŸ¤º', 'ğŸ‡', 'â›³', 'ğŸ£', 'ğŸŒï¸', 'ğŸ¤½', 'ğŸš£', 'ğŸ§˜', 'ğŸƒ',

        // Technology & Work
        'ğŸ’¼', 'ğŸ’»', 'ğŸ“±', 'âŒ¨ï¸', 'ğŸ–¥ï¸', 'ğŸ“Š', 'ğŸ“ˆ', 'ğŸ“‰', 'ğŸ¯', 'ğŸ†',
        'ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', 'ğŸ“', 'ğŸ“š', 'ğŸ“–', 'âœï¸', 'ğŸ–Šï¸', 'ğŸ“', 'ğŸ”¬',
        'ğŸ”­', 'âš™ï¸', 'ğŸ› ï¸', 'ğŸ”§', 'ğŸ”¨', 'âš¡', 'ğŸ’¡', 'ğŸ“¡', 'ğŸ–±ï¸', 'ğŸ’¾',

        // Entertainment & Music
        'ğŸ®', 'ğŸ•¹ï¸', 'ğŸ¯', 'ğŸ²', 'â™Ÿï¸', 'ğŸ¸', 'ğŸ¹', 'ğŸ¤', 'ğŸ§', 'ğŸµ',
        'ğŸ¼', 'ğŸ¬', 'ğŸ¥', 'ğŸ“·', 'ğŸ“¸', 'ğŸ­', 'ğŸª', 'ğŸ¨', 'ğŸ–Œï¸', 'ğŸº',
        'ğŸ·', 'ğŸ»', 'ğŸ¥', 'ğŸ™ï¸', 'ğŸ“»', 'ğŸ“º', 'ğŸï¸', 'ğŸ¬', 'ğŸ®', 'ğŸ°',

        // Vehicles & Transportation
        'ğŸš—', 'ğŸš™', 'ğŸï¸', 'ğŸš•', 'ğŸšŒ', 'ğŸš', 'ğŸï¸', 'ğŸ›µ', 'ğŸš²', 'ğŸ›´',
        'âœˆï¸', 'ğŸ›©ï¸', 'ğŸš€', 'ğŸ›¸', 'ğŸš', 'ğŸ›¶', 'â›µ', 'ğŸš¤', 'ğŸ›³ï¸', 'â›´ï¸',
        'ğŸš‚', 'ğŸšƒ', 'ğŸš„', 'ğŸš…', 'ğŸš†', 'ğŸš‡', 'ğŸšˆ', 'ğŸš‰', 'ğŸšŠ', 'ğŸš',

        // Food & Drinks
        'ğŸ•', 'ğŸ”', 'ğŸŸ', 'ğŸŒ­', 'ğŸ¿', 'ğŸ¥“', 'ğŸ–', 'ğŸ—', 'ğŸ¥©', 'ğŸŒ®',
        'ğŸŒ¯', 'ğŸ¥™', 'ğŸ³', 'ğŸ¥', 'ğŸ§‡', 'ğŸœ', 'ğŸ', 'ğŸ›', 'ğŸ£', 'ğŸ±',
        'ğŸº', 'ğŸ»', 'ğŸ¥‚', 'ğŸ·', 'ğŸ¥ƒ', 'â˜•', 'ğŸµ', 'ğŸ§ƒ', 'ğŸ¥¤', 'ğŸ§‹',

        // Nature & Animals
        'ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ¨', 'ğŸ¯',
        'ğŸ¦', 'ğŸ®', 'ğŸ·', 'ğŸ¸', 'ğŸµ', 'ğŸ”', 'ğŸ§', 'ğŸ¦', 'ğŸ¤', 'ğŸ¦…',
        'ğŸ¦†', 'ğŸ¦‰', 'ğŸº', 'ğŸ—', 'ğŸ´', 'ğŸ¦„', 'ğŸ¦“', 'ğŸ¦Œ', 'ğŸŠ', 'ğŸ¢',
        'ğŸ¦•', 'ğŸ¦–', 'ğŸ™', 'ğŸ¦‘', 'ğŸ¦ˆ', 'ğŸ‹', 'ğŸ³', 'ğŸ¬', 'ğŸŸ', 'ğŸ ',

        // Objects & Items
        'âš½', 'ğŸ€', 'ğŸˆ', 'âš¾', 'ğŸ¥', 'ğŸ¾', 'ğŸ', 'ğŸ‰', 'ğŸ¥', 'ğŸ±',
        'ğŸ“', 'ğŸ¸', 'ğŸ’', 'ğŸ‘', 'ğŸ¥', 'ğŸ', 'â›³', 'ğŸ¹', 'ğŸ£', 'ğŸ¤¿',
        'ğŸ¥Š', 'ğŸ¥‹', 'ğŸ½', 'ğŸ›¹', 'ğŸ›·', 'â›¸ï¸', 'ğŸ¥Œ', 'ğŸ¿', 'â›·ï¸', 'ğŸ‚',

        // Buildings & Places
        'ğŸ ', 'ğŸ¡', 'ğŸ¢', 'ğŸ£', 'ğŸ¤', 'ğŸ¥', 'ğŸ¦', 'ğŸ¨', 'ğŸ©', 'ğŸª',
        'ğŸ«', 'ğŸ¬', 'ğŸ­', 'ğŸ¯', 'ğŸ°', 'ğŸ—¼', 'ğŸ—½', 'â›ª', 'ğŸ•Œ', 'ğŸ›•',
        'ğŸ›ï¸', 'â›©ï¸', 'ğŸ•', 'â›²', 'â›º', 'ğŸŒ', 'ğŸŒƒ', 'ğŸ™ï¸', 'ğŸŒ„', 'ğŸŒ…',

        // Professions
        'ğŸ‘¨â€ğŸ’»', 'ğŸ‘¨â€ğŸ”¬', 'ğŸ‘¨â€ğŸ«', 'ğŸ‘¨â€âš–ï¸', 'ğŸ‘¨â€ğŸ”§', 'ğŸ‘¨â€ğŸ­', 'ğŸ‘¨â€ğŸš€', 'ğŸ‘¨â€âœˆï¸', 'ğŸ‘¨â€ğŸš’', 'ğŸ‘¨â€âš•ï¸',
        'ğŸ‘¨â€ğŸŒ¾', 'ğŸ‘¨â€ğŸ³', 'ğŸ‘¨â€ğŸ“', 'ğŸ‘¨â€ğŸ¤', 'ğŸ‘¨â€ğŸ¨', 'ğŸ‘¨â€ğŸ’¼', 'ğŸ‘”', 'ğŸ©', 'ğŸ‘“', 'ğŸ•¶ï¸'
    ],

    female: [
        // People & Faces
        'ğŸ‘§', 'ğŸ§’', 'ğŸ‘¶', 'ğŸ‘©', 'ğŸ§‘', 'ğŸ˜Š', 'ğŸ¤“', 'ğŸ§', 'ğŸ˜', 'ğŸ¥³',
        'ğŸ¤©', 'ğŸ˜', 'ğŸ˜', 'ğŸ™‚', 'ğŸ¤—', 'ğŸ¤”', 'ğŸ§‘â€ğŸ“', 'ğŸ‘©â€ğŸ“', 'ğŸ‘©â€ğŸ’¼',
        'ğŸ’', 'ğŸ™‹', 'ğŸ’…', 'ğŸ’ƒ', 'ğŸ•º', 'ğŸ‘¯', 'ğŸ§–', 'ğŸ’†', 'ğŸ§˜', 'ğŸ¤³',

        // Fashion & Beauty
        'ğŸ‘—', 'ğŸ‘ ', 'ğŸ‘œ', 'ğŸ‘›', 'ğŸ‘’', 'ğŸ€', 'ğŸ’„', 'ğŸ’…', 'ğŸ’', 'ğŸ’',
        'ğŸŒ¹', 'ğŸŒ¸', 'ğŸŒº', 'ğŸŒ»', 'ğŸŒ·', 'ğŸŒ¼', 'ğŸµï¸', 'ğŸ¥€', 'ğŸ’', 'ğŸŒ¿',
        'âœ¨', 'â­', 'ğŸŒŸ', 'ğŸ’«', 'âš¡', 'ğŸ”¥', 'ğŸ’¥', 'ğŸ’¢', 'ğŸ’¦', 'ğŸ’¨',

        // Activities & Hobbies
        'ğŸ’ƒ', 'ğŸ©°', 'ğŸ§˜', 'ğŸ‹ï¸', 'ğŸ¤¸', 'ğŸƒ', 'ğŸš´', 'ğŸŠ', 'ğŸ§—', 'â›·ï¸',
        'ğŸ‚', 'ğŸ¤½', 'ğŸš£', 'ğŸ§œ', 'ğŸ§š', 'ğŸ‘¸', 'ğŸ¤±', 'ğŸ™†', 'ğŸ™…', 'ğŸ’',
        'ğŸ™‹', 'ğŸ¤¦', 'ğŸ¤·', 'ğŸ’‡', 'ğŸ’†', 'ğŸ§–', 'ğŸ’…', 'ğŸ¤³', 'ğŸ’ƒ', 'ğŸ•º',

        // Arts & Creativity
        'ğŸ¨', 'ğŸ–Œï¸', 'ğŸ­', 'ğŸª', 'ğŸ¬', 'ğŸ¤', 'ğŸ§', 'ğŸµ', 'ğŸ¼', 'ğŸ¹',
        'ğŸ¸', 'ğŸº', 'ğŸ·', 'ğŸ»', 'ğŸ¥', 'ğŸ“·', 'ğŸ“¸', 'ğŸ“¹', 'ğŸ¥', 'ğŸï¸',
        'ğŸ–¼ï¸', 'ğŸ¨', 'ğŸ–ï¸', 'ğŸ–Œï¸', 'ğŸ–Šï¸', 'âœï¸', 'ğŸ“', 'ğŸ’Œ', 'ğŸ’', 'ğŸ’–',

        // Technology & Education
        'ğŸ’»', 'ğŸ“±', 'âŒ¨ï¸', 'ğŸ–¥ï¸', 'ğŸ“Š', 'ğŸ“ˆ', 'ğŸ“', 'ğŸ“š', 'ğŸ“–', 'âœï¸',
        'ğŸ“', 'ğŸ¯', 'ğŸ†', 'ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', 'ğŸ…', 'ğŸ’¼', 'ğŸ“‹', 'ğŸ“Œ',

        // Food & Drinks
        'â˜•', 'ğŸ°', 'ğŸ§', 'ğŸª', 'ğŸ©', 'ğŸ‚', 'ğŸ­', 'ğŸ¬', 'ğŸ«', 'ğŸ¿',
        'ğŸ“', 'ğŸ‡', 'ğŸˆ', 'ğŸ‰', 'ğŸŠ', 'ğŸ‹', 'ğŸŒ', 'ğŸ', 'ğŸ¥­', 'ğŸ',
        'ğŸ', 'ğŸ', 'ğŸ‘', 'ğŸ’', 'ğŸ…', 'ğŸ¥—', 'ğŸ¥™', 'ğŸ±', 'ğŸ£', 'ğŸ·',
        'ğŸ¥‚', 'ğŸ¾', 'ğŸ§ƒ', 'ğŸ§‹', 'ğŸµ', 'ğŸ§‰', 'ğŸ¥¤', 'ğŸ§Š', 'ğŸ¨', 'ğŸ§',

        // Nature & Flowers
        'ğŸŒ¸', 'ğŸŒº', 'ğŸŒ»', 'ğŸŒ·', 'ğŸŒ¹', 'ğŸ¥€', 'ğŸ’', 'ğŸµï¸', 'ğŸŒ¼', 'ğŸŒ¿',
        'â˜˜ï¸', 'ğŸ€', 'ğŸŒ±', 'ğŸŒ¾', 'ğŸŒ²', 'ğŸŒ³', 'ğŸŒ´', 'ğŸª´', 'ğŸ‹', 'ğŸ',
        'ğŸ¦‹', 'ğŸ', 'ğŸ', 'ğŸ¦„', 'ğŸ¦¢', 'ğŸ•Šï¸', 'ğŸ¦š', 'ğŸ¦œ', 'ğŸ¦©', 'ğŸˆ',

        // Objects & Accessories
        'ğŸ’', 'ğŸ’', 'ğŸ‘‘', 'ğŸ‘’', 'ğŸ€', 'ğŸ', 'ğŸˆ', 'ğŸ‰', 'ğŸŠ', 'ğŸ‹',
        'ğŸ', 'ğŸ', 'ğŸ§§', 'ğŸ€', 'ğŸ—ï¸', 'ğŸ®', 'ğŸ†', 'ğŸ‡', 'âœ¨', 'ğŸ’«',
        'â­', 'ğŸŒŸ', 'ğŸ’¥', 'ğŸ’¢', 'ğŸ’¦', 'ğŸ’¨', 'ğŸŒˆ', 'â˜ï¸', 'â›…', 'ğŸŒ¤ï¸',

        // Buildings & Places  
        'ğŸ ', 'ğŸ¡', 'ğŸ˜ï¸', 'ğŸ°', 'ğŸ¯', 'ğŸ—¼', 'ğŸ—½', 'â›ª', 'ğŸ•Œ', 'ğŸ›•',
        'ğŸ’’', 'â›©ï¸', 'ğŸª', 'ğŸ¡', 'ğŸ¢', 'ğŸ ', 'â›²', 'â›±ï¸', 'ğŸ–ï¸', 'ğŸï¸',

        // Professions
        'ğŸ‘©â€ğŸ’»', 'ğŸ‘©â€ğŸ”¬', 'ğŸ‘©â€ğŸ«', 'ğŸ‘©â€âš–ï¸', 'ğŸ‘©â€âš•ï¸', 'ğŸ‘©â€ğŸŒ¾', 'ğŸ‘©â€ğŸ³', 'ğŸ‘©â€ğŸ“', 'ğŸ‘©â€ğŸ¤', 'ğŸ‘©â€ğŸ¨',
        'ğŸ‘©â€âœˆï¸', 'ğŸ‘©â€ğŸš€', 'ğŸ‘©â€ğŸš’', 'ğŸ‘©â€ğŸ’¼', 'ğŸ§•', 'ğŸ‘°', 'ğŸ¤°', 'ğŸ¤±', 'ğŸ‘¸', 'ğŸ§š',

        // Hearts & Love
        'ğŸ’–', 'ğŸ’—', 'ğŸ’“', 'ğŸ’', 'ğŸ’•', 'ğŸ’Ÿ', 'â£ï¸', 'ğŸ’”', 'â¤ï¸', 'ğŸ§¡',
        'ğŸ’›', 'ğŸ’š', 'ğŸ’™', 'ğŸ’œ', 'ğŸ¤', 'ğŸ–¤', 'ğŸ¤', 'ğŸ’', 'ğŸ’Œ', 'ğŸ’'
    ]
};

/**
 * Simple hash function to convert string to number
 * Used for deterministic emoji selection
 */
function hashString(str: string): number {
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
        const char = str.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash; // Convert to 32-bit integer
    }
    return Math.abs(hash);
}

/**
 * Get emoji avatar for a user based on their gender
 * 
 * @param user - User object containing id, handle, and gender
 * @returns Emoji character representing the user
 */
export function getEmojiAvatar(user: {
    id?: string;
    handle?: string;
    gender?: string;
}): string {
    // Determine gender (default to male if not specified)
    const gender = user.gender?.toLowerCase() === 'female' ? 'female' : 'male';

    // Get emoji pool for this gender
    const emojiPool = EMOJI_LIBRARY[gender];

    // Generate deterministic seed from user identifier
    const seed = user.id || user.handle || 'default-user';
    const hash = hashString(seed);

    // Select emoji from pool using hash
    const index = hash % emojiPool.length;

    return emojiPool[index];
}

/**
 * Convert emoji to data URI for use in img src
 * This creates a clean SVG with the emoji centered
 */
export function emojiToDataUri(emoji: string, backgroundColor: string = '#1f2937'): string {
    const svg = `
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
      <circle cx="50" cy="50" r="50" fill="${backgroundColor}"/>
      <text 
        x="50" 
        y="50" 
        font-size="60" 
        text-anchor="middle" 
        dominant-baseline="central"
        font-family="system-ui, -apple-system, sans-serif"
      >${emoji}</text>
    </svg>
  `.trim();

    // Use URI encoding instead of base64 since emojis are multi-byte UTF-8 characters
    return `data:image/svg+xml;utf8,${encodeURIComponent(svg)}`;
}

/**
 * Get emoji avatar as data URI (for use in img src)
 */
export function getEmojiAvatarUri(user: {
    id?: string;
    handle?: string;
    gender?: string;
}, backgroundColor?: string): string {
    const emoji = getEmojiAvatar(user);
    return emojiToDataUri(emoji, backgroundColor);
}
